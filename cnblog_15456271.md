---
title: JAVA æ— å›¾å½¢ç•Œé¢ å•çº¿ç¨‹èŠå¤©ç¨‹åº
date: 2021-10-24 15:13:00
categories:
- ç¬”è®°
- åšå®¢å›­
tags:
- åšå®¢å›­
- æ¬å®¶
- cnblogs
---
# [è¿™æ˜¯ğŸ‘‰JAVA æ— å›¾å½¢ç•Œé¢ å•çº¿ç¨‹èŠå¤©ç¨‹åºğŸ‘ˆçš„æ‘˜è¦](../../../../2021/10/24/cnblog_15456271/)
<!--more-->
[toc] ##èµ·å› 
æƒ³ç”¨JAVAåšä¸€ä¸ªèŠå¤©å®¤ç¨‹åºï¼Œå­¦äº†TCPé‡ŒSocketå’ŒServerSocketï¼Œå°±è ¢è ¢æ¬²åŠ¨ï¼Œå†™äº†ä¸€ä¸ªåªèƒ½å›å¤ä¸€æ¡æ‰èƒ½çœ‹åˆ°æ”¶åˆ°çš„ç®€å•ç¨‹åºã€‚ ##çŸ¥è¯†ç‚¹ã€‚
###å®¢æˆ·ç«¯ Socket client = new Socket("localhost",8888) ; // å®¢æˆ·ç«¯è¿æœåŠ¡å™¨
BufferedReader buf = new BufferedReader(new
InputStreamReader(client.getInputStream())) ; // è¾“å…¥æµï¼Œä¹‹åç”¨äºè¯»å– PrintStream out =
new PrintStream(client.getOutputStream()) ; // è¾“å‡ºæµï¼Œå‘é€æ•°æ® ###æœåŠ¡å™¨ ServerSocket
ss=new ServerSocket(8888); Socket byclient = ss.accept() ; //
è¿™ä¸ªclientæ˜¯æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„socketï¼› æ³¨æ„åé¢IOæµï¼ï¼ï¼å¾—åˆ°è¿æ¥ï¼Œç¨‹åºè¿›å…¥åˆ°é˜»å¡çŠ¶æ€ out = new
PrintStream(byclient.getOutputStream()) ; //è¾“å‡ºæµ BufferedReader buf = new
BufferedReader(new InputStreamReader(byclient.getInputStream())) ;// è¾“å…¥æµ
ï¼ï¼ï¼æ³¨æ„å¯¹æ¯”ï¼å‡†å¤‡æ¥æ”¶å®¢æˆ·ç«¯çš„è¾“å…¥ä¿¡æ¯ ##é—®é¢˜ æƒ³äº†å¾ˆä¹…éƒ½æ²¡æ³•å®ç°æ­£å¸¸çš„èŠå¤©åŠŸèƒ½ï¼Œè¦ä¹ˆåªèƒ½æ¥ä¸€æ¡å‘ä¸€æ¡å°±ç»“æŸï¼Œè¦ä¹ˆå°±åªèƒ½ä¸€ç›´æ¥ã€‚ã€‚ã€‚
ç„¶åæŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°éœ€è¦ç”¨å¤šçº¿ç¨‹çš„çŸ¥è¯†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ ##ä»£ç  ###æˆ‘çš„ç®€å•èŠå¤© ####æœåŠ¡å™¨ç«¯ ``` import java.io.*; import
java.net.*; public class SERV { Socket cl; ServerSocket ser; public SERV()
throws IOException { this.ser = new ServerSocket(9999); InetAddress inetAddr =
InetAddress.getLocalHost(); System.out.println("Connecting,LocalIP:"+
inetAddr.getHostAddress()); this.cl = ser.accept();
//System.out.println("Connected"); PrintStream ot=new
PrintStream(cl.getOutputStream()); BufferedReader rd=new BufferedReader(new
InputStreamReader(System.in)); BufferedReader in= new BufferedReader(new
InputStreamReader(cl.getInputStream())); ot.println("plz"); while (true){
System.out.println(); System.out.print("Client:"); String clt=in.readLine();
System.out.println(clt); System.out.print("Message:"); String out =
rd.readLine(); ot.println(out); } } public static void main(String[] args)
throws IOException { SERV SERV=new SERV(); } } ``` ####å®¢æˆ·ç«¯ ``` import
java.io.*; import java.net.*; public class CL { Socket cl; public CL(String
ip) throws IOException { this.cl=new Socket(ip,9999);
System.out.println("OK"); BufferedReader in= new BufferedReader(new
InputStreamReader(cl.getInputStream())); BufferedReader rd=new
BufferedReader(new InputStreamReader(System.in)); PrintStream ot=new
PrintStream(cl.getOutputStream(),true); ot.println("connected"); while (true)
{ System.out.print("Server:"); String sv = in.readLine();
System.out.println(sv); System.out.println("Message:"); String msg =
rd.readLine(); ot.println(msg); } } public static void main(String[] args)
throws IOException { System.out.println("enter your dest-ip:"); BufferedReader
br=new BufferedReader(new InputStreamReader(System.in)); String ip=
br.readLine(); CL CL=new CL(ip); } } ```
![](https://img2020.cnblogs.com/blog/2015058/202110/2015058-20211024231122385-653646197.png)
![](https://img2020.cnblogs.com/blog/2015058/202110/2015058-20211024231201122-855388813.png)
###å¤šçº¿ç¨‹ ####å®¢æˆ·ç«¯ï¼š ``` import java.io.IOException; import java.io.PrintStream;
import java.net.Socket; import java.util.Scanner; //è¯»çº¿ç¨‹ class ReadFromServer
implements Runnable{ private Socket client; public ReadFromServer(Socket
client) { this.client = client; } @Override public void run() { try {
//è·å–è¾“å…¥æµæ¥å–å¾—æœåŠ¡å™¨å‘æ¥çš„ä¿¡æ¯ Scanner in = new Scanner(client.getInputStream()); while
(true){ if (client.isClosed()){ System.out.println("å®¢æˆ·ç«¯å·²ç»å…³é—­"); in.close();
break; } if(in.hasNext()){ String msgFromServer = in.nextLine();
System.out.println("æœåŠ¡å™¨å‘æ¥çš„ä¿¡æ¯ä¸ºï¼š"+msgFromServer); } } } catch (IOException e) {
e.printStackTrace(); } } } //å†™çº¿ç¨‹ class SendMsgToServer implements Runnable{
private Socket client; public SendMsgToServer(Socket client) { this.client =
client; } @Override public void run() { try { PrintStream out = new
PrintStream(client.getOutputStream(),true,"UTF-8"); Scanner in = new
Scanner(System.in); while (true){ System.out.println("è¯·è¾“å…¥è¦å‘æœåŠ¡å™¨å‘é€çš„ä¿¡æ¯..");
String strFromUser = ""; if (in.hasNext()){ strFromUser = in.nextLine(); }
//å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ out.println(strFromUser); //byebye if
(strFromUser.contains("byebye")){ System.out.println("å½“å‰å®¢æˆ·ç«¯é€€å‡ºèŠå¤©å®¤");
out.close(); in.close(); client.close(); break; } } } catch (IOException e) {
e.printStackTrace(); } } } public class MutilThreadClient { public static void
main(String[] args) throws IOException { //æ ¹æ®æŒ‡å®šipåŠç«¯å£å·å»ºç«‹è¿æ¥ Socket client = new
Socket("127.0.0.1",6666); //å¯åŠ¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹ Thread readThread = new Thread(new
ReadFromServer(client)); Thread sendThread = new Thread(new
SendMsgToServer(client)); readThread.start(); sendThread.start(); } } ```
####æœåŠ¡å™¨ï¼š ``` import java.io.IOException; import java.io.PrintStream; import
java.net.ServerSocket; import java.net.Socket; import java.util.Iterator;
import java.util.Map; import java.util.Scanner; import
java.util.concurrent.ConcurrentHashMap; import
java.util.concurrent.ExecutorService; import java.util.concurrent.Executors;
import java.util.regex.Matcher; import java.util.regex.Pattern; import
java.util.Set; public class MutilThreadServer { private static Map clientLists
= new ConcurrentHashMap<>(); //ä¸“é—¨ç”¨æ¥å¤„ç†æ¯ä¸ªå®¢æˆ·ç«¯çš„è¾“å…¥ï¼Œè¾“å‡ºè¯·æ±‚ private static class
ExecuteClientRequest implements Runnable{ private Socket client; public
ExecuteClientRequest(Socket client) { this.client = client; } @Override public
void run() { try { //è·å–ç”¨æˆ·è¾“å…¥æµï¼Œè¯»å–ç”¨æˆ·å‘æ¥çš„ä¿¡æ¯ Scanner in = new
Scanner(client.getInputStream()); String strFromClient = ""; while (true){ if
(in.hasNext()){ strFromClient = in.nextLine(); } //windowsä¸‹æ¶ˆé™¤ç”¨æˆ·è¾“å…¥è‡ªå¸¦çš„\r Pattern
pattern = Pattern.compile("\r"); Matcher matcher =
pattern.matcher(strFromClient); strFromClient = matcher.replaceAll(""); /*
æ³¨å†Œï¼šusername:xxx * ç¾¤èŠï¼šGï¼šç¾¤èŠå†…å®¹ * ç§èŠï¼šPï¼šç”¨æˆ·å-ç§èŠå†…å®¹ * ç”¨æˆ·é€€å‡ºï¼šbyebye*/ //æ³¨å†Œæµç¨‹ if
(strFromClient.startsWith("username:")){ String username =
strFromClient.split("\\\:")[1]; Register(username,client); } //ç¾¤èŠæµç¨‹ if
(strFromClient.startsWith("G:")){ String groupMsg =
strFromClient.split("\\\:")[1]; groupChat(groupMsg); } //ç§èŠ if
(strFromClient.startsWith("P:")){ String username =
strFromClient.split("\\\:")[1].split("\\\\-")[0]; String privateMsg =
strFromClient.split("\\\:")[1].split("\\\\-")[2];
privateChat(username,privateMsg); } //ç”¨æˆ·é€€å‡ºï¼š1ï¼šbyebye
if(strFromClient.contains("byebye")){ String username =
strFromClient.split("\\\:")[0]; userOffLine(username); break; } } } catch
(IOException e) { e.printStackTrace(); } } private void Register(String
username,Socket socket){ clientLists.put(username,socket);
System.out.println("ç”¨æˆ·"+username+"ä¸Šçº¿äº†ï¼å½“å‰èŠå¤©å®¤äººæ•°ä¸ºï¼š"+clientLists.size()); try {
PrintStream out = new PrintStream(socket.getOutputStream(),true,"UTF-8");
out.println("æ³¨å†ŒæˆåŠŸ"); out.println("å½“å‰èŠå¤©å®¤äººæ•°ä¸ºï¼š"+clientLists.size()); } catch
(IOException e) { e.printStackTrace(); } } //ç¾¤èŠâ€”â€”éå†mapï¼Œå‘æ¯ä¸ªå®¢æˆ·ç«¯è¾“å‡ºä¸€é private void
groupChat(String groupMsg) throws IOException { Set> clientEntry =
clientLists.entrySet(); Iterator> iterator = clientEntry.iterator(); while
(iterator.hasNext()){ //å–å‡ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯å®ä½“ Map.Entry client = iterator.next();
//æ‹¿åˆ°å®¢æˆ·ç«¯è¾“å‡ºæµè¾“å‡ºç¾¤èŠä¿¡æ¯ PrintStream out = new
PrintStream(client.getValue().getOutputStream(), true,"UTF-8");
out.println("ç¾¤èŠä¿¡æ¯ä¸ºï¼š"+groupMsg); } } //ç§èŠ private void privateChat(String
username,String privateMsg) throws IOException { //å–å‡ºusernameå¯¹åº”çš„Socket Socket
client = clientLists.get(username); PrintStream out = new
PrintStream(client.getOutputStream(),true,"UTF-8");
out.println("ç§èŠä¿¡æ¯ä¸ºï¼š"+privateMsg); } private void userOffLine(String username){
//åˆ é™¤mapä¸­çš„ç”¨æˆ·å®ä½“ clientLists.remove(username);
System.out.println("ç”¨æˆ·"+username+"å·²ä¸‹çº¿"); } } public static void main(String[]
args) throws Exception { ServerSocket serverSocket = new ServerSocket(6666);
//ä½¿ç”¨çº¿ç¨‹æ± æ¥åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ ExecutorService executorService =
Executors.newFixedThreadPool(20); System.out.println("ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥"); for (int
i=0;i<20;i++){ Socket client = serverSocket.accept();
System.out.println("æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œç«¯å£å·ä¸ºï¼š"+client.getPort());
executorService.submit(new ExecuteClientRequest(client)); } //å…³é—­çº¿ç¨‹æ± ä¸æœåŠ¡ç«¯
executorService.shutdown(); serverSocket.close(); } } ```


